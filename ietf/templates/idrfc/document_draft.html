{% extends "base.html" %}

{% load ietf_filters %}

{% block title %}{{ name }}-{{ doc.rev }}{% endblock %}

{% block pagehead %}
<link rel="stylesheet" type="text/css" href="/css/doc.css"></link>
<meta name="description" content="{{ doc.title }} (Internet-Draft, {{ doc.time|date:"Y" }})" />
{% endblock %}

{% block content %}
{{ top|safe }}

{% comment %}
<div class="snapshots">
  Snapshots:
  <span class="revisions">
    {% for rev in revisions %}
    <a {% if rev != doc.rev %}href="{% url doc_view name=doc.name %}{% if not forloop.last %}{{ rev }}/{% endif %}"{% endif %}>{{ rev }}</a>
    {% endfor %}
  </span>
</div>
{% endcomment %}

<div class="ietf-box metabox">
  <div>
    {{ doc.get_state }} {% if not doc.get_state_slug == "rfc" %}Internet-Draft{% endif %}
    ({{ submission|safe }})

    {% if resurrected_by %}- resurrect requested by {{ resurrected_by }}{% endif %}
  </div>

  <table id="metatable" width="100%">
    <tr>
      <td>Document Stream:</td>
      <td><a {% if can_change_stream %} class="editlink" href="{% url doc_change_stream name=doc.name %}"{% endif %}>
      {{ doc.stream|default:"No stream defined" }}</a></td>
    </tr>

    <tr>
      <td>Last updated:</td>
      <td>{{ doc.time|date:"Y-m-d" }}</td>
    </tr>

    {% if replaces %}
    <tr>
      <td>Replaces:</td>
      <td>{{ replaces|join:", "|urlize_ietf_docs }}</td>
    </tr>
    {% endif %}

    {% if replaced_by %}
    <tr>
      <td>Replaced by:</td>
      <td>{{ replaced_by|join:", "|urlize_ietf_docs }}</td>
    </tr>
    {% endif %}

    {% if conflict_reviews %}
    <tr>
      <td>IETF Conflict Review:</td>
      <td>{{ conflict_reviews|join:", "|urlize_ietf_docs }}</td>
    </tr>
    {% endif %}

    <tr>
      <td>Intended RFC status:</td>
      <td>
        <a {% if can_edit %}class="editlink" href="{% url doc_change_intended_status name=doc.name %}"{% endif %}>
        {{ doc.intended_std_level|default:"(None)" }}</a>
      </td>
    </tr>

    <tr>
      <td>Other versions:</td>
      <td>
        {% if doc.get_state_slug != "active" %}(expired, archived):{% endif %}
        {% for label, url in file_urls %}<a href="{{ url }}">{{ label}}</a>{% if not forloop.last%}, {% endif %}{% endfor %}
      </td>
    </tr>

    <tr><td colspan='2'><hr size='1' noshade /></td></tr>

    <tr>
       <td>{{ doc.stream }} State:</td>
       <td class="stream-state">
         <a {% if can_edit_stream_info %}class="editlink" href="{% url edit_state name=doc.name %}"{% endif %}>
           {{ stream_state|default:"(None)" }}
         </a>

       {% if stream_tags %}<br /><i>{% for tag in tags %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</i>{% endif %}

       {% for m in milestones %}
         <span title="In {{ m.group.acronym }} milestone: {{ m.desc }}" class="milestone">{{ m.due|date:"M Y" }}</span>
       {% endfor %}
       </td>
    </tr>

    {% if consensus %}
    <tr>
      <td>Consensus:</td>
      <td>
        <a title="Whether the document is the result of a community consensus process as defined in RFC 5741" {% if can_edit_consensus %}class="editlink" href="{% url doc_edit_consensus name=doc.name %}"{% endif %}>
          {{ consensus }}
        </a>
      </td>
    </tr>
    {% endif %}

    <tr>
      <td>Document shepherd:</td>
      <td>
        {# the shepherd edit page only works for WGs at the moment ... #}
        <a {% if can_edit_stream_info and group.type_id == "wg" %}class="editlink" href="{% url doc_managing_shepherd acronym=group.acronym,name=doc.name %}"{% endif %}>
        {{ doc.shepherd|default:"(None)" }}
        </a>
      </td>
    </tr>

    {# the shepherd write up page only works for WGs at the moment ... #}
    {% if group.type_id == "wg" %}
    {% if shepherd_writeup or can_edit_shepherd_writeup %}
    <tr>
      <td>Shepherd Write-Up:</td>
      <td>
        <a {% if can_edit_shepherd_writeup %}class="editlink"{% endif %} href="{% url doc_managing_writeup acronym=group.acronym,name=doc.name %}">
        {% if shepherd_writeup %}Last changed {{ shepherd_writeup.time|date:"Y-m-d"}}{% else %}(None){% endif %}
        </a>
      </td>
    </tr>
    {% endif %}
    {% endif %}

    <tr><td colspan='2'><hr size='1' noshade /></td></tr>

    <tr>
      <td><a href="/idtracker/help/state/">IESG State</a>:</td>
      <td>
        <a {% if iesg_state and can_edit %}class="editlink" href="{% url doc_change_state name=doc.name %}"{% endif %}>
        {{ doc.friendly_state|safe }}</a>

        {% if iana_review_state %}
        <div>IANA Review State:
          <a {% if can_edit_iana_state %}class="editlink" href="{% url doc_change_iana_state name=doc.name state_type="iana-review" %}"{% endif %}>{{ iana_review_state }}</a>
        </div>
        {% endif %}

        {% if iana_review_state %}
        <div>IANA Action State:
          <a {% if can_edit_iana_state %}class="editlink" href="{% url doc_change_iana_state name=doc.name state_type="iana-action" %}"{% endif %}>{{ iana_action_state }}</a>
        </div>
        {% endif %}

        {% if rfc_editor_state %}
        <div>
          RFC Editor State:
          <a href="http://www.rfc-editor.org/queue2.html#{{ doc.name }}">{{ rfc_editor_state }}</a></div>
        {% endif %}

        <div class="telechat">
        <a {% if can_edit %}class="editlink" href="{% url doc_change_telechat_date name=doc.name %}"{% endif %}>

          {% if telechat %}
            On agenda of {{ telechat.telechat_date }} IESG telechat {% if telechat.returning_item %} (returning item){% endif %}
          {% else %}
            {% if can_edit %}Not on an upcoming telechat agenda{% endif %}
          {% endif %}
          </a>
          </div>

        {% if ballot_summary %}<div class="ballot-summary">({{ ballot_summary }})</div>{% endif %}
      </td>
    </tr>

    <tr>
      <td>Responsible AD:</td>
      <td>
        <a {% if can_edit %}class="editlink" href="{% url doc_change_ad name=doc.name %}"{% endif %}>
          {{ doc.ad|default:"(None)" }}
        </a>
      </td>
    </tr>

    {% if iesg_state %}
    {% if doc.note or can_edit %}
    <tr>
      <td>IESG Note:</td>
      <td>
        <a {% if can_edit %}class="editlink" href="{% url doc_change_iesg_note name=doc.name %}"{% endif %}>
          {{ doc.note|default:"(None)"|format_textarea|safe }}
        </a>
      </td>
    </tr>
    {% endif %}
    {% endif %}

    <tr>
      <td>Send notices to:</td>
      <td>
        <a {% if can_edit %}class="editlink" href="{% url doc_change_notify name=doc.name %}"{% endif %}>
          {{ doc.notify|default:"No addresses provided"}}
        </a>
      </td>
    </tr>

    <tr><td colspan='2'><hr size='1' noshade /></td></tr>
  </table>

  <div class="links">
    <a href="mailto:{{ doc.name }}@tools.ietf.org?subject=Mail%20regarding%20{{ doc.name }}" rel="nofollow">Email Authors</a>
  | <a href="/ipr/search/?option=document_search&amp;id={{ doc.name }}" rel="nofollow">IPR Disclosures</a>
  | <a href="http://www.fenron.net/~fenner/ietf/deps/index.cgi?dep={{ doc.name }}" rel="nofollow">Dependencies to this draft</a>
  | <a href="http://tools.ietf.org/idnits?url=http://tools.ietf.org/id/{{ doc.filename_with_rev }}" rel="nofollow" target="_blank">Check nits</a>
  | <a href="/feed/comments/{{ doc.name }}/">History feed</a>
  | <a href="http://www.google.com/search?as_q={{ doc.name }}&as_sitesearch={{ search_archive }}" rel="nofollow" target="_blank">Search Mailing Lists</a>
  {% if user|has_role:"Area Director" %}
  | <a href="https://www.iesg.org/bin/c5i?mid=6&rid=77&target={{ doc.name }}" rel="nofollow" target="_blank">Search Mailing Lists (ARO)</a>
  {% endif %}
  </div>

  {% if can_edit and iesg_state %}
  <div class="links">
    <a href="{% url doc_ballot_lastcall name=doc.name %}">Last Call Text</a>
  | <a href="{% url doc_ballot_writeupnotes name=doc.name %}">Ballot Text</a>
  | <a href="{% url doc_ballot_approvaltext name=doc.name %}">Announcement Text</a>
  </div>
  {% endif %}

  {% if actions %}
  <div class="actions">
    {% for label, url in actions %}<a class="button" href="{{ url }}">{{ label }}</a> {% endfor %}
  </div>
  {% endif %}
</div>

{% if doc.get_state_slug == "active" %}

<div class="document-markup">
{{ content|safe }}
</div>

{% if split_content %}
<p><a style="display:inline-block;margin-left:17em;" href="?include_text=1">[include full document text]</a></p>
{% endif %}

{% else %}

<p>This Internet-Draft is no longer active. Unofficial copies of old Internet-Drafts can be found here:<br/>
<a href="http://tools.ietf.org/id/{{ doc.name }}">http://tools.ietf.org/id/{{ doc.name }}</a></p>

<h4>Abstract</h4>

<p>{{ doc.abstract|escape }}</p>

<h4>Authors</h4>

<p>
  {% for author in doc.documentauthor_set.all %}
  <a {% if not author.author.invalid_address %}href="mailto:{{ author.author.address }}"{% endif %}>{{ author.author.person }} {% if not author.author.invalid_address %}&lt;{{ author.author.address }}&gt;{% endif %}</a>
  {% if not forloop.last %}<br/>{% endif %}{% endfor %}
</p>

<p>(Note: The e-mail addresses provided for the authors of this Internet-Draft may no longer be valid)</p>

{% endif %}

{% endblock %}

