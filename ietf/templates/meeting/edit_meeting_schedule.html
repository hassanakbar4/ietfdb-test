{% extends "base.html" %}
{# Copyright The IETF Trust 2015-2020, All Rights Reserved #}
{% load origin %}
{% load staticfiles %}
{% load ietf_filters %}

{% block morecss %}
  {% for parent in session_parents %}
    .parent-{{ parent.acronym }} {
       background: linear-gradient(to right, {{ parent.scheduling_color }} 0.4em, transparent 0.5em);
    }
  {% endfor %}
{% endblock morecss %}

{% block title %}{{ schedule.name }}: IETF {{ meeting.number }} meeting schedule{% endblock %}

{% block js %}
  <script type='text/javascript'>
   var ietfData = {{ js_data|safe }};
  </script>
  <script type="text/javascript" src="{% static 'ietf/js/edit-meeting-schedule.js' %}"></script>
{% endblock js %}


{% block content %}
  {% origin %}
  <div class="edit-meeting-schedule">

    <p class="pull-right">
      <a href="{% url "ietf.meeting.views.copy_meeting_schedule" num=meeting.number owner=schedule.owner_email name=schedule.name %}">Copy schedule</a>
      &middot;

      <a href="{% url "ietf.meeting.views.list_schedules" num=meeting.number %}">All schedules for meeting</a>
    </p>

    <p>
      Schedule name: {{ schedule.name }}

      &middot;

      Owner: {{ schedule.owner }}

      {% if not can_edit %}
        &middot;

        <em>You can't edit this schedule. Take a copy first.</em>
      {% endif %}
    </p>

    <div class="edit-grid">
      {# in order for all this to align properly vertically, we have the same structure in all columns #}

      <div class="time-labels-column schedule-column">
        <div class="room-name"></div>

        {% for d in time_labels %}
          <div class="day-label">{{ d.day|date:"l, F j, Y" }}</div>

          <div class="day" style="height: {{ d.height }}em;">
            {% for t, vertical_alignment, vertical_offset, horizontal_alignment in d.labels %}
              <div class="time-label {{ vertical_alignment }}-aligned text-{{ horizontal_alignment }}" style="{{ vertical_alignment }}: {{ vertical_offset }}em;">
                <span>{{ t|date:"H:i" }}</span>
              </div>
            {% endfor %}
          </div>
        {% endfor %}
      </div>

      {% for r in room_columns %}
        <div class="room-column schedule-column" data-roomcapacity="{{ r.room.capacity }}">
          <div class="room-name">{{ r.room.name }}{% if r.room.capacity %} ({{ r.room.capacity }} <i class="fa fa-user-o"></i>{% endif %})</div>

          {% for d in r.days %}
            <div class="day-label"></div> {# for spacing purposes #}

            <div class="day" style="height: {{ d.height }}em;">
              {% for t in d.timeslots %}
                <div id="timeslot{{ t.timeslot.pk }}" class="timeslot" data-start="{{ t.timeslot.time.isoformat }}" data-end="{{ t.timeslot.end_time.isoformat }}" data-duration="{{ t.timeslot.duration.total_seconds }}" style="top: {{ t.offset }}em; height: {{ t.height }}em;">
                  {% for assignment, session in t.timeslot.session_assignments %}
                    {% include "meeting/edit_meeting_schedule_session.html" %}
                  {% endfor %}
                </div>
              {% endfor %}
            </div>
          {% endfor %}
        </div>
      {% endfor %}
    </div>

    <div class="scheduling-panel">
      <div class="unassigned-container">
        <div class="unassigned-sessions">
          {% for session in unassigned_sessions %}
            {% include "meeting/edit_meeting_schedule_session.html" %}
          {% endfor %}
        </div>

        <div class="preferences">
          <span class="sort-unassigned">
            Sort unassigned:
            <select name="sort_unassigned" class="form-control">
              <option value="name" selected="selected">By name</option>
              <option value="parent">By area</option>
              <option value="duration">By duration</option>
              <option value="comments">Special requests</option>
            </select>
          </span>

          <span class="session-parent-toggles">
            Show:
            {% for p in session_parents %}
              <label class="parent-{{ p.acronym }}"><input type="checkbox" checked value="{{ p.acronym }}"> {{ p.acronym }}</label>
            {% endfor %}
          </span>
        </div>
      </div>

      <div class="session-info-container"></div>
    </div>

  </div>
{% endblock %}
