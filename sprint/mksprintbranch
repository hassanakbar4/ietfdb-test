#!/bin/bash

version=0.20
program=${0##*/}
progdir=${0%/*}
if [ "$progdir" = "$program" ]; then progdir="."; fi

function die() { 
    echo -e "\n$program: error: ${*:0:160} ..."  >&2
    exit 1
}

function warn() { 
	logger -i -p user.warn -t $program "$*"
	echo "$program: Warning: $*" 1>&2; 
}

function note() { 
	logger -i -p user.notice -t $program "$*"
	if [ -n "$OPT_VERBOSE" ]; then echo -e "$*"; fi
}

function version() {  
	echo -e "$program: v$version\n\nRunning as $(id -urn) on $(date +'%Y-%m-%d %H:%M')"
}

[ "$1" -gt 70 ] || die "Expected the ietf number as argument on the command line, but found '$1'."

num=$1

cat $progdir/sprint$num.txt | while read login email name; do 
	echo $login $email $name
#	if ! svn info http://svn.tools.ietf.org/svn/tools/ietfdb/sprint/$num/$login >/dev/null 2>&1 ; then
	    svn cp http://svn.tools.ietf.org/svn/tools/ietfdb/branch/2.00 http://svn.tools.ietf.org/svn/tools/ietfdb/sprint/$num/$login -m "IETF $num Sprint branch for $name"
	    mail $email -s "Your SVN branch for the IETF $num code sprint." <<-EOF
		Hi,

		This mail has been automatically generated by the $program script.

		An SVN branch has been set up for you for the IETF $num code sprint, at
		  http://svn.tools.ietf.org/svn/tools/ietfdb/sprint/$num/$login
		and you can check it out by doing
		  svn co http://svn.tools.ietf.org/svn/tools/ietfdb/sprint/$num/$login

		More instructions about setup is available at
		  http://trac.tools.ietf.org/tools/ietfdb/wiki/SprintCoderSetup
		and this sprint's plan is available at 
		  http://trac.tools.ietf.org/tools/ietfdb/wiki/IETF${num}Sprint


		Best,

		       Henrik (via the $program script)

		EOF
#	fi
done
